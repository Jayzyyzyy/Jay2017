# 运输层1 #

## 一、运输层服务

运输层协议：

- 为运行在不同主机上的**应用进程提供逻辑通信**功能（主机好像是直接相连的）。
- 进程之间使用逻辑通信功能彼此发送报文，无需考虑具体物理链路。
- **运输层协议运行在端系统**，不在路由器中。
- **路由器只根据网络层字段而动作**。中间路由器既不处理也不识别运输层加在报文上的任何信息。


###1.运输层和网络层的关系

- 运输层位于网络层上。
- **网络层提供主机之间的逻辑通信**
- **运输层为运行在不同主机上的进程之间提供逻辑通信**；

###2.因特网运输层概述

####①因特网运输层协议：

- UDP(用户数据报协议)：为应用程序提供**不可靠、无连接**的服务。
- TCP(传输控制协议)：为应用程序提供**可靠的、面向连接**的服务。

####②术语：

- 报文段(segment)：运输层分组。
- 数据报（datagram）：网络层分组。

####③因特网网络层

- IP（网际协议）：为主机之间提供逻辑通信。
- IP服务模型：尽力交付服务。尽最大的努力在通信的主机之间交付报文段，但不保证按序交付或数据的完整性。**属于不可靠服务**。
- IP地址：主机的网络层地址。每台主机有一个。

###④UDP和TCP的服务模型：

- **将两个端系统间IP的交付服务扩展为运行在两个端系统上的进程之间的交付服务**。
- 可提供完整性检查。
- UDP是不可靠服务
- TCP提供可靠数据传输及拥塞控制。 

## 二、多路复用与分解

> 多路复用与分解: **将网络层所提供的主机到主机交付服务扩展到在主机上运行的应用程序到应用程序的交付服务。**

![](http://onh97xzo0.bkt.clouddn.com/3-1.PNG)

###1.套接字Socket

![](http://onh97xzo0.bkt.clouddn.com/3-2.PNG)

- 从网络向进程传递数据，或从进程向网络传递数据的门户。
- 运输层和应用进程通过套接字来传递数据。
- **主机上的套接字可以有多个**，每个套接字都有惟一的标识符（格式取决于UDP或TCP）。 

###2.多路复用、多路分解

- 多路复用（发送主机）：
	- 从不同套接字收集数据块，并为每个数据块封装上首部信息，生成报文段，传递到网络层。
- 多路分解（接收主机）：
	- 将报文段中的数据交付到正确的套接字。即接收方运输层从报文段的多个字段中，识别出套接字，并将报文段定向到该套接字。

###3.报文段格式

![](http://onh97xzo0.bkt.clouddn.com/3-3.PNG)

端口号：主机上的每个套接字分配一个端口号。16位（0～65535）。0～1023为周知端口号，保留给固定的应用程序。

###4.无连接的多路复用与分解

- **UDP套接字组成：二元组（IP地址，端口号）**；
- 两个具有不同源套接字，但具有相同目的套接字的UDP报文段，可通过相同套接字定向到相同的目的进程（**多对一**）；
- 源端口号的用途：目的方回发报文段中的“返回地址”。

###5.面向连接的多路复用与分解

- TCP套接字： **四元组 (源IP地址，源端口号，目的IP地址，目的端口号)**
	- 目的主机使用全部四个值来将收到的TCP报文段定向(分解)到相应的套接字。
	- **两个具有不同源套接字的TCP报文段，将被定向到两个不同的套接字**。


