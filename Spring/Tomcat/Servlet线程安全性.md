# Servlet线程安全性

Servlet容器启动时，会对每一个Servlet对象实例化一次，而且是仅仅一次，在运行的时候，不管多少个请求都是同时执行这一个Servlet对象实例。也就是说**Servlet对象是单实例多线程**。

	三个方法

	init()
	service()
	destroy()

一、Servlet线程不安全的原因：

- 实例变量：实例变量在类中定义。类的每一个实例都拥有自己的实例变量，如果多个线程同时访问该实例的方法，而该方法又使用到实例变量，那么这些线程同时访问的是同一个实例变量，会共享该实例变量。（**线程不安全**）
- 局部变量：局部变量在方法中定义。每当一个线程访问局部变量所在的方法时，在线程的堆栈中就会创建这个局部变量，线程执行完这个方法时，该局部变量就被销毁。所有多个线程同时访问该方法时，每个线程都有自己的局部变量，不会共享。

二、解决办法

1. 设计Servlet是无状态的，即不使用成员变量(避免)
2. 如果使用成员变量，则需要加锁同步
3. 避免使用非线程安全的集合
4. **多个Servlet中对某个外部对象(例如文件)的修改时务必加锁（Synchronized，或者ReentrantLock），互斥访问。**
